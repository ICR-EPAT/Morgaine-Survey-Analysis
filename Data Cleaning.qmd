---
title: "Data Cleaning"
format: html
editor: visual
---

```{r import data, include=TRUE}
library(readxl)

estimanddb <- read_xlsx("Morgaine Data Cleaning.xlsx")
```

```{r check for missing in all fields required for cleaning, include=TRUE}

#NCT Number missing values:

print("Count of total missing values")
sum(is.na(estimanddb$`NCT number (if available)`))
print("Position of missing values ")
which(is.na(estimanddb$`NCT number (if available)`))

# "Count of total missing values"
# 1
# "Position of missing values "
# 1986

#Does not appear to have NCT number, use "Nil known" for NCT Number field in row 1986.

estimanddb$`NCT number (if available)`[is.na(estimanddb$`NCT number (if available)`)] <- "Nil known"

print("Count of total missing values")
sum(is.na(estimanddb$`NCT number (if available)`))
print("Position of missing values ")
which(is.na(estimanddb$`NCT number (if available)`))

#[1] "Count of total missing values"
#[1] 0
#[1] "Position of missing values "
#integer(0)

##################################################################################################################################

#ISRCTN Number missing values:

print("Count of total missing values")
sum(is.na(estimanddb$`ISRCTN number (if available)`))
print("Position of missing values ")
which(is.na(estimanddb$`ISRCTN number (if available)`))

#[1] "Count of total missing values"
#[1] 0
#[1] "Position of missing values "
#integer(0)

##################################################################################################################################

#Funding Type missing values:

print("Count of total missing values")
sum(is.na(estimanddb$`Funding type`))
print("Position of missing values ")
which(is.na(estimanddb$`Funding type`))

#[1] "Count of total missing values"
#[1] 27
#[1] "Position of missing values "
# [1] 1961 1963 1964 1965 1967 1970 1971 1983 1986 1987 1990 2000 2002 2006 2007 2009 2012 2014 2016 2018 2028 2034 2035 2041
#[25] 2043 2053 2060

table(estimanddb$'Funding type')

#    government organisation                       INDIV                    Industry                Not industry 
#                         62                           4                        1133                         825 
#private sector organisation 
#                         14 

estimanddb$`Funding type`[is.na(estimanddb$`Funding type`)] <- "Missing"

print("Count of total missing values")
sum(is.na(estimanddb$`Funding type`))
print("Position of missing values ")
which(is.na(estimanddb$`Funding type`))

#[1] "Count of total missing values"
#[1] 0
#[1] "Position of missing values "
#integer(0

##################################################################################################################################

#Trial design missing values

print("Count of total missing values")
sum(is.na(estimanddb$`Trial design`))
print("Position of missing values ")
which(is.na(estimanddb$`Trial design`))

#[1] "Count of total missing values"
#[1] 0
#[1] "Position of missing values "
#integer(0)

##################################################################################################################################

#Intervention type missing values

print("Count of total missing values")
sum(is.na(estimanddb$`Intervention type`))
print("Position of missing values ")
which(is.na(estimanddb$`Intervention type`))

#[1] "Count of total missing values"
#[1] 0
#[1] "Position of missing values "
#integer(0)

##################################################################################################################################

#Protocol available missing values

print("Count of total missing values")
sum(is.na(estimanddb$`Protocol file available?`))
print("Position of missing values ")
which(is.na(estimanddb$`Protocol file available?`))

#[1] "Count of total missing values"
#[1] 263

#Large amount of 'Protocol available' values missing - double check with Morgaine how she would like me to proceed? May potentially need individual checking and entering.

##################################################################################################################################

#SAP available missing values

print("Count of total missing values")
sum(is.na(estimanddb$`SAP file available?`))
print("Position of missing values ")
which(is.na(estimanddb$`SAP file available?`))

#[1] "Count of total missing values"
#[1] 265

#Large amount of 'SAP available' values missing - double check with Morgaine how she would like me to proceed? May potentially need individual checking and entering.

##################################################################################################################################

#Trial phase missing values

print("Count of total missing values")
sum(is.na(estimanddb$`Trial Phase`))
print("Position of missing values ")
which(is.na(estimanddb$`Trial Phase`))

#[1] "Count of total missing values"
#[1] 0
#[1] "Position of missing values "
#integer(0)

##################################################################################################################################

#Sponsor type missing values

print("Count of total missing values")
sum(is.na(estimanddb$`Sponsor type`))
print("Position of missing values ")
which(is.na(estimanddb$`Sponsor type`))

#[1] "Count of total missing values"
#[1] 1897

#Large amount of 'Sponsor type' values missing - double check with Morgaine how she would like me to proceed? May potentially need individual checking and entering.

#Checked with Morgaine - To categorise all missing values in 'Sponsor type' as "Missing" due to data not available from CTGOV registry.

estimanddb$`Sponsor type`[is.na(estimanddb$`Sponsor type`)] <- "Missing"

print("Count of total missing values")
sum(is.na(estimanddb$`Sponsor type`))
print("Position of missing values ")
which(is.na(estimanddb$`Sponsor type`))

#[1] "Count of total missing values"
#[1] 0
#[1] "Position of missing values "
#integer(0)

#Save as xlsx file, enter Protocol & SAP information - re-upload for cleaning/encoding.

library(writexl)

write_xlsx(estimanddb, "C:/Users/jskinner/OneDrive - The Institute of Cancer Research/Desktop/Morgaine/GitHub/Data Cleaning/Morgaine-Survey-Analysis/Estimand_Sheet1.xlsx")
```

